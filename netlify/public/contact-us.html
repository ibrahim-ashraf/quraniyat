<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="تواصل مع منصة مفتاح العلوم لتعليم كلام الحي القيوم. نحن هنا للإجابة على استفساراتك ومساعدتك في رحلة تعلم القرآن الكريم.">
  <meta name="author" content="منصة مفتاح العلوم لتعليم كلام الحي القيوم">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="اتصل بنا - منصة مفتاح العلوم لتعليم كلام الحي القيوم">
  <meta property="og:description" content="تواصل مع منصة مفتاح العلوم لتعليم كلام الحي القيوم. نحن هنا للإجابة على استفساراتك ومساعدتك في رحلة تعلم القرآن الكريم.">

  <meta name="twitter:title" content="اتصل بنا - منصة مفتاح العلوم لتعليم كلام الحي القيوم">
  <meta name="twitter:description" content="تواصل مع منصة مفتاح العلوم لتعليم كلام الحي القيوم. نحن هنا للإجابة على استفساراتك ومساعدتك في رحلة تعلم القرآن الكريم.">

  <title>اتصل بنا - منصة مفتاح العلوم لتعليم كلام الحي القيوم</title>

  <link rel="stylesheet" href="style.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<body>
  <header>
    <div id="nav-container"></div>
  </header>

  <main class="contact-page">

    <section class="contact-hero">

      <h1>اتصل بنا</h1>
      <p class="subtitle">نحن هنا لمساعدتك في رحلة تعلم كتاب الله</p>
      <p class="help-text">قبل التواصل معنا، يمكنك الاطلاع على <a href="/faq.html">الأسئلة الشائعة</a> للعثور على إجابة سريعة لسؤالك.</p>
    </section>

    <div class="contact-content">

      <section class="contact-form-section">
        <h2>نموذج الاتصال</h2>
        <p>لم تجد إجابة لسؤالك؟ راسلنا وسنرد عليك في أقرب وقت ممكن.</p>

        <form name="contact" id="contact-form" class="contact-form" action="/.netlify/functions/submit" method="post">
          <div class="form-row">
            <div class="form-group">
              <label for="first-name-input">الاسم الأول</label>
              <input type="text" name="first-name" id="first-name-input" required>
            </div>
            <div class="form-group">
              <label for="last-name-input">اسم العائلة</label>
              <input type="text" name="last-name" id="last-name-input" required>
            </div>
          </div>

          <div class="form-group">
            <label for="email-input">البريد الإلكتروني</label>
            <input type="email" name="email" id="email-input" required>
          </div>

          <div class="form-group">
            <label for="subject-select">الموضوع</label>
            <select name="subject" id="subject-select" required>
              <option value="">اختر الموضوع</option>
              <option value="technical">مشكلة تقنية</option>
              <option value="registration">استفسار عن التسجيل</option>
              <option value="study">استفسار عن الدراسة</option>
              <option value="teacher">طلب تغيير معلم</option>
              <option value="payment">استفسار عن الدفع</option>
              <option value="change_email">تغيير البريد الإلكتروني</option>
              <option value="delete_account">حذف الحساب</option>
              <option value="suggestion">اقتراح</option>
              <option value="complaint">شكوى</option>
              <option value="other">موضوع آخر</option>
            </select>
          </div>

          <div id="reason-group" class="form-group" style="display: none;">
            <label for="reason-select">سبب الطلب</label>
            <select name="reason" id="reason-select">
              <option value="">اختر السبب</option>
              <!-- أسباب تغيير البريد -->
              <optgroup label="أسباب تغيير البريد" class="email-reasons" style="display: none;">
                <option value="lost_access">فقدت الوصول للبريد القديم</option>
                <option value="security">أسباب أمنية</option>
                <option value="personal">تفضيل شخصي</option>
                <option value="other_email">سبب آخر</option>
              </optgroup>
              <!-- أسباب حذف الحساب -->
              <optgroup label="أسباب حذف الحساب" class="delete-reasons" style="display: none;">
                <option value="not_useful">لم أعد بحاجة للخدمة</option>
                <option value="not_satisfied">غير راضٍ عن الخدمة</option>
                <option value="privacy">مخاوف تتعلق بالخصوصية</option>
                <option value="other_delete">سبب آخر</option>
              </optgroup>
            </select>
          </div>

          <div id="account-email-group" class="form-group" style="display: none;">
            <label for="account-email">البريد الإلكتروني المرتبط بالحساب</label>
            <div class="email-input-container">
              <input type="email" name="account-email" id="account-email">
              <button type="button" id="forgot-email-btn" class="secondary-button">نسيت البريد الإلكتروني</button>
            </div>
          </div>

          <div id="identity-info-group" class="form-group" style="display: none;">
            <label for="identity-info">معلومات إضافية للتحقق من هويتك</label>
            <textarea name="identity-info" id="identity-info" rows="5" placeholder="يرجى تقديم أكبر قدر ممكن من المعلومات التي تساعدنا في التحقق من هويتك مثل:
- تاريخ إنشاء الحساب التقريبي
- اسم المعلم الحالي
- آخر موعد حصة
- أي معلومات أخرى تساعد في التحقق من هويتك"></textarea>
          </div>

          <div id="message-group" class="form-group">
            <label for="message-input">الرسالة</label>
            <textarea name="message" id="message-input" rows="5" required></textarea>
          </div>

          <div class="form-group">
            <div class="g-recaptcha" data-sitekey="6LcVNQYqAAAAACqRgKGCml2-HzpoRoPUjddtHvDQ"></div>
          </div>

          <div class="form-submit">
            <button type="submit" id="submit-button" class="primary-button">
              <span class="button-text">إرسال الرسالة</span>
              <div class="loader" style="display: none;">
                <div class="spinner"></div>
              </div>
            </button>
          </div>
        </form>
      </section>

      <section class="contact-info-section">
        <h2>تابعنا على وسائل التواصل الاجتماعي</h2>
        <div class="social-links">
          <a href="https://www.facebook.com/meftah.aloloom" target="_blank" class="social-link facebook">
            <i class="fab fa-facebook"></i>
            صفحتنا على فيسبوك
          </a>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 منصة مفتاح العلوم لتعليم كلام الحي القيوم. جميع الحقوق محفوظة.</p>
  </footer>

  <script src="loadNav.js"></script>
  <script>
    // تهيئة المتغيرات
    const form = document.getElementById('contact-form');
    const subjectSelect = document.getElementById('subject-select');
    const reasonGroup = document.getElementById('reason-group');
    const reasonSelect = document.getElementById('reason-select');
    const accountEmailGroup = document.getElementById('account-email-group');
    const identityInfoGroup = document.getElementById('identity-info-group');
    const messageGroup = document.getElementById('message-group');
    const forgotEmailBtn = document.getElementById('forgot-email-btn');
    const emailReasons = reasonSelect.querySelector('.email-reasons');
    const deleteReasons = reasonSelect.querySelector('.delete-reasons');

    // إدارة تغيير الموضوع
    subjectSelect.addEventListener('change', () => {
      const subject = subjectSelect.value;
      const isSpecialCase = ['change_email', 'delete_account'].includes(subject);

      reasonGroup.style.display = isSpecialCase ? 'block' : 'none';
      accountEmailGroup.style.display = isSpecialCase ? 'block' : 'none';
      messageGroup.style.display = isSpecialCase ? 'none' : 'block';

      // إظهار/إخفاء مجموعات الأسباب المناسبة
      if (subject === 'change_email') {
        emailReasons.style.display = 'block';
        deleteReasons.style.display = 'none';
      } else if (subject === 'delete_account') {
        emailReasons.style.display = 'none';
        deleteReasons.style.display = 'block';
      }

      // إعادة تعيين الحقول
      reasonSelect.value = '';
      identityInfoGroup.style.display = 'none';
      if (!isSpecialCase) {
        accountEmailGroup.querySelector('input').value = '';
      }
    });

    // إدارة زر "نسيت البريد الإلكتروني"
    forgotEmailBtn.addEventListener('click', () => {
      accountEmailGroup.style.display = 'none';
      identityInfoGroup.style.display = 'block';
      accountEmailGroup.querySelector('input').value = '';
      identityInfoGroup.querySelector('textarea').focus();
    });

    // تعديل السلوك الافتراضي للنموذج
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const subject = subjectSelect.value;
      const isSpecialCase = ['change_email', 'delete_account'].includes(subject);

      // التحقق من ملء الحقول المطلوبة
      if (isSpecialCase) {
        if (!reasonSelect.value) {
          alert('يرجى اختيار سبب الطلب');
          reasonSelect.focus();
          return;
        }

        const accountEmail = accountEmailGroup.querySelector('input').value;
        const identityInfo = identityInfoGroup.querySelector('textarea').value;

        if (!accountEmail && !identityInfo) {
          alert('يرجى إدخال البريد الإلكتروني المرتبط بالحساب أو معلومات التحقق من الهوية');
          return;
        }
      }

      // عرض مؤشر التحميل
      buttonText.style.display = 'none';
      loader.style.display = 'block';
      submitButton.disabled = true;

      try {
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData);

        const adminEmail = {
          to: 'ibrahim.ashraf.contact@gmail.com',
          subject: 'رسالة جديدة من نموذج الاتصال - مفتاح العلوم',
          text: `بيانات جديدة من نموذج الاتصال:\n\n${JSON.stringify(data, null, 2)}`,
          html: `
                        <h1 style="color: #009688;">رسالة جديدة من نموذج الاتصال</h1>
                        <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
                            <p><strong>الاسم:</strong> ${data['first-name']} ${data['last-name']}</p>
                            <p><strong>البريد الإلكتروني:</strong> ${data.email}</p>
                            <p><strong>الموضوع:</strong> ${data.subject}</p>
                            <p><strong>الرسالة:</strong></p>
                            <p style="white-space: pre-wrap;">${data.message}</p>
                        </div>
                    `
        };

        const userEmail = {
          to: data.email,
          subject: 'تم استلام رسالتك - منصة مفتاح العلوم',
          text: `السلام عليكم ${data['first-name']}،\n\nشكراً لتواصلك مع منصة مفتاح العلوم. تم استلام رسالتك وسنقوم بالرد عليك في أقرب وقت ممكن.\n\nمع أطيب التحيات،\nفريق منصة مفتاح العلوم`,
          html: `
                        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #009688; text-align: center;">تم استلام رسالتك</h1>
                            <p style="text-align: right;">السلام عليكم ${data['first-name']}،</p>
                            <p style="text-align: right;">شكراً لتواصلك مع منصة مفتاح العلوم. تم استلام رسالتك وسنقوم بالرد عليك في أقرب وقت ممكن.</p>
                            <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="color: #009688; margin-top: 0;">تفاصيل رسالتك:</h3>
                                <p><strong>الموضوع:</strong> ${data.subject}</p>
                                <p><strong>الرسالة:</strong></p>
                                <p style="white-space: pre-wrap;">${data.message}</p>
                            </div>
                            <p style="text-align: right;">مع أطيب التحيات،<br>فريق منصة مفتاح العلوم</p>
                        </div>
                    `
        };

        const result = await submitForm(data, 'contact_form', adminEmail, userEmail);

        if (!result.error) {
          // إظهار رسالة النجاح
          form.reset();
          alert('تم إرسال رسالتك بنجاح. سنرد عليك في أقرب وقت ممكن.');
        }
      } catch (error) {
        // إظهار رسالة الخطأ المناسبة
        if (error.message === 'server') {
          alert('عذراً، حدث خطأ في معالجة طلبك. يرجى التحقق من اختبار reCAPTCHA والمحاولة مرة أخرى.');
        } else {
          alert('عذراً، حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى لاحقاً.');
        }
      } finally {
        // إعادة الزر لحالته الطبيعية
        buttonText.style.display = 'block';
        loader.style.display = 'none';
        submitButton.disabled = false;
      }
    });
  </script>
</body>

</html>